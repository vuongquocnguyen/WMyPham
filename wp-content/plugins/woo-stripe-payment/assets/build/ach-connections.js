(()=>{var e={506:e=>{e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},575:e=>{e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},913:e=>{function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}},713:e=>{e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},525:(e,t,n)=>{var r=n(331);function o(t,n,a){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=o=Reflect.get:e.exports=o=function(e,t,n){var o=r(e,t);if(o){var a=Object.getOwnPropertyDescriptor(o,t);return a.get?a.get.call(n):a.value}},o(t,n,a||t)}e.exports=o},754:e=>{function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(n)}e.exports=t},205:(e,t,n)=>{var r=n(489);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},318:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}}},585:(e,t,n)=>{var r=n(8),o=n(506);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?o(e):t}},489:e=>{function t(n,r){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(n,r)}e.exports=t},331:(e,t,n)=>{var r=n(754);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e}},8:e=>{function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=t=function(e){return typeof e}:e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(n)}e.exports=t},567:e=>{"use strict";e.exports=window.jQuery},707:e=>{"use strict";e.exports=window.wc_stripe}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}(()=>{var e=n(318),t=e(n(713)),r=e(n(575)),o=e(n(913)),a=e(n(525)),i=e(n(205)),c=e(n(585)),s=e(n(754)),u=e(n(567)),p=n(707);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?l(Object(r),!0).forEach((function(n){(0,t.default)(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function f(e){p.BaseGateway.call(this,e),p.CheckoutGateway.call(this)}Object.assign(f.prototype,p.BaseGateway.prototype,p.CheckoutGateway.prototype),new(function(e){(0,i.default)(l,e);var t,n,p=(t=l,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,s.default)(t);if(n){var o=(0,s.default)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,c.default)(this,e)});function l(e){var t;return(0,r.default)(this,l),(t=p.call(this,e)).handle_create_account_change(),t}return(0,o.default)(l,[{key:"initialize",value:function(){window.addEventListener("hashchange",this.hashchange.bind(this)),(0,u.default)(document.body).on("payment_method_selected",this.payment_method_selected.bind(this)),(0,u.default)(document.body).on("click","#place_order",this.on_order_pay.bind(this)),(0,u.default)(document.body).on("change","#createaccount",this.handle_create_account_change.bind(this))}},{key:"updated_checkout",value:function(){this.handle_create_account_change()}},{key:"checkout_place_order",value:function(){return this.payment_token_received=!0,(0,a.default)((0,s.default)(l.prototype),"checkout_place_order",this).call(this)}},{key:"on_order_pay",value:function(e){var t=this;if(this.is_gateway_selected())if(this.is_change_payment_method()){var n=this.params,r=n.order_id,o=n.order_key;e.preventDefault(),this.create_setup_intent({order_id:r,order_key:o}).then((function(e){var n=e.setup_intent;t.handle_payment_method_setup({order_id:r,order_key:o,client_secret:n.client_secret})}))}else this.is_current_page("order_pay")&&(e.preventDefault(),this.process_order_pay())}},{key:"handle_next_action",value:function(e){var t=this,n=e.client_secret;this.stripe.collectBankAccountForPayment({clientSecret:n,params:{payment_method_type:"us_bank_account",payment_method_data:{billing_details:{name:this.get_customer_name(this.get_billing_prefix()),email:this.fields.get("billing_email",null)}}}}).then((function(n){var r=n.paymentIntent,o=n.error;if(o)return t.submit_error(o);"requires_confirmation"===r.status?t.do_payment_confirmation(e):t.cancel_payment_processing()}))}},{key:"handle_payment_method_setup",value:function(e){var t=this,n=e.client_secret;this.stripe.collectBankAccountForSetup({clientSecret:n,params:{payment_method_type:"us_bank_account",payment_method_data:{billing_details:{name:this.get_customer_name(this.get_billing_prefix()),email:this.fields.get("billing_email",null)}}}}).then((function(n){var r=n.setupIntent,o=n.error;if(o)return t.submit_error(o);"requires_confirmation"===r.status?t.do_setup_confirmation(e):t.cancel_payment_processing()}))}},{key:"do_payment_confirmation",value:function(e){var t=this,n=e.client_secret,r=e.order_id,o=e.order_key;this.stripe.confirmUsBankAccountPayment(n).then((function(e){var n=e.paymentIntent,a=e.error;if(a)return t.submit_error(a);if("requires_payment_method"===n.status)t.cancel_payment_processing();else{if("requires_action"===n.status)return t.cancel_payment_processing(),t.submit_error({code:"ach_instant_only"});"processing"===n.status&&(t.set_nonce(n.payment_method),t.is_current_page("order_pay")?t.get_form().trigger("submit"):t.process_payment(r,o))}}))}},{key:"do_setup_confirmation",value:function(e){var t=this,n=e.client_secret,r=e.order_id,o=e.order_key;this.stripe.confirmUsBankAccountSetup(n).then((function(e){var n=e.setupIntent,a=e.error;if(a)return t.submit_error(a);if("requires_payment_method"===n.status)t.cancel_payment_processing();else{if("requires_action"===n.status)return t.cancel_payment_processing(),t.submit_error({code:"ach_instant_only"});"succeeded"===n.status&&(t.set_nonce(n.payment_method),t.is_current_page("order_pay")||t.is_change_payment_method()?t.get_form().trigger("submit"):t.process_payment(r,o))}}))}},{key:"hide_place_order",value:function(){}},{key:"show_payment_button",value:function(){this.show_place_order()}},{key:"cancel_payment_processing",value:function(){var e;(0,u.default)(this.container).closest("form").removeClass("processing"),null===(e=(0,u.default)(this.container).closest("form"))||void 0===e||e.unblock()}},{key:"fees_enabled",value:function(){return"1"==this.params.fees_enabled}},{key:"payment_method_selected",value:function(){this.fees_enabled()&&(0,u.default)(document.body).trigger("update_checkout")}},{key:"create_setup_intent",value:function(e){var t=this;return new Promise((function(n,r){u.default.ajax({method:"POST",dataType:"json",data:_({payment_method:t.gateway_id},e),url:t.params.routes.base_path.replace("%s","wc-stripe/v1/subscriptions/setup-intent"),beforeSend:t.ajax_before_send.bind(t)}).done((function(e){e.code?r(e.message):n(e)})).fail((function(e,n,r){t.submit_error(r)}))}))}}]),l}(f))(wc_stripe_ach_connections_params)})()})();
//# sourceMappingURL=ach-connections.js.map